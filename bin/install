#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
REPO="$(dirname "$DIR")"

echo "Installing apt dependencies..."
sudo apt-get install -y pigpio

BOX_CONFIG="$REPO/config/config.yml"
if [ -f "$BOX_CONFIG" ]; then
  echo "Skipping copy default config.yml because $BOX_CONFIG already exists."
else
  echo "Copying default box-config.yml..."
  cp "$REPO/config/config.example.yml" "$BOX_CONFIG"
fi

echo "Installing and starting systemd service..."
START_COMMAND="$(which npx) on-air"
sudo "$DIR/.installService" "$REPO/config/on-air-box.service" "$START_COMMAND"
